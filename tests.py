test_lines = """G0 F300 X183.472 Y122.607 Z10
G0 F9000 X131.866 Y130.988
G0 X129.435 Y131.059
;TIME_ELAPSED:4711.664193
;LAYER:49
;TYPE:WALL-INNER
;MESH:main_body.stl
G1 F2700 E193.50341
G1 F1500 X130.656 Y131.193 E193.54426
G1 X136.348 Y129.252 E193.74863
G1 X137.232 Y128.4 E193.78946
G1 X129.435 Y131.059 E195.26076
G0 F9000 X129.508 Y130.665
;TYPE:WALL-OUTER
G1 F1500 X130.671 Y130.792 E195.29967
G1 X131.84 Y130.75 E195.33858
G1 X131.017 Y160.231 E214.38734
G0 F9000 X131.077 Y159.894
G0 X130.2 Y158.736
;TYPE:FILL
G1 F3000 X144.607 Y104.969 E216.23872
G0 F9000 X142.854 Y105.737
G1 F3000 X118.095 Y111.184 E221.58984
G1 F2700 E254.15531
G0 X136.244 Y129.128
G0 X136.735 Y128.655
G0 X138.438 Y126.777
G1 F2700 E259.15531
G1 F3000 X158.754 Y147.093 E260.11091
G0 X136.244 Y129.128
G0 X136.735 Y128.655
G0 X138.438 Y126.777
G1 F2700 E259.15531
G1 F3000 X158.754 Y147.093 E260.11091
G0 F9000 X158.085 Y147.397
G1 F3000 X139.372 Y123.966 E265.63054
G1 F2700 E260.63054
G0 F9000 X182.938 Y124.189
G1 F2700 E265.63054
G1 F3000 X183.411 Y122.426 E265.69125
G0 F9000 X183.346 Y122.527
G1 F2700 E260.69125
;MESH:NONMESH"""

if __name__ == "__main__":
	from gcode import GcodeFile
	from threader import TLayer
	from geometry_helpers import gcode2segments
	from parsers import cura4

	g = GcodeFile(filestring=test_lines, layer_class=TLayer)
	p,s,e = gcode2segments(g.layers[0].lines, z=10)

	lines = p + [s[0].gc_lines[0]] + sum([seg.gc_lines for seg in s], []) + e

	print('Lines missing:', set(g.lines).difference(lines))
